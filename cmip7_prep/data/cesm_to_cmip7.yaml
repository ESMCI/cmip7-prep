# cesm_to_cmip7.yaml — CMIP-keyed schema with CMIP6 compatibility
#
# Top-level keys are CMIP variable names.
# Each variable can be defined either with:
#   - new-style 'sources' (preferred for complex/multi-source),
#   - or CMIP6-style 'raw_variables' + 'formula' (+ 'unit_conversion', 'levels', etc.).
#
# This allows direct reuse of CMIP6 tables while supporting newer expressive mappings.

dataset_overrides:
  institution_id: NCAR
  source_id: CESM3
  nominal_resolution: 100 km

variables:
  agessc_tavg-ol-hxy-sea:
    table: ocean
    long_name: "Ideal Age of Sea Water"
    units: "yr"
    dims: [time, olevel, latitude, longitude]
    sources:
      - cesm_var: agessc

  cl_tavg-al-hxy-u:
    table: atmos
    units: "%"
    long_name: Cloud Area Fraction
    standard_name: cloud_area_fraction
    cell_methods: "time: mean"
    dims: [time, lev, lat, lon]         # keep model levels
    formula: CLOUD * 100
    levels:
      name: standard_hybrid_sigma
      units: "1"
      src_axis_name: lev                 # model midlevel dimension
      src_axis_bnds: ilev                # model interface/bounds dim (if you ever need it)
    sources:
      - cesm_var: CLOUD

  cli_tavg-al-hxy-u:
    table: atmos
    units: "kg kg-1"
    dims: [time, lev, lat, lon]
    levels:
      name: standard_hybrid_sigma
      units: "1"
      src_axis_name: lev
      src_axis_bnds: ilev
    sources:
      - cesm_var: CLDICE

  cLitter_tavg-u-hxy-lnd:
    table: land
    units: "kg m-2"
    dims: [time, lat, lon]
    formula: (TOTLITC + CWD_C)/1000.0
    sources:
      - cesm_var: TOTLITC
      - cesm_var: CWD_C

  clivi_tavg-u-hxy-u:
    table: atmos
    units: "kg m-2"
    dims: [time, lat, lon]
    sources:
      - cesm_var: TGCLDIWP

  clt_tavg-u-hxy-u:
    table: atmos
    units: "%"
    dims: [time, lat, lon]
    formula: CLDTOT * 100
    sources:
      - cesm_var: CLDTOT

  clw_tavg-al-hxy-u:
    table: atmos
    units: "kg kg-1"
    dims: [time, lev, lat, lon]
    levels:
      name: standard_hybrid_sigma
      units: "1"
      src_axis_name: lev
      src_axis_bnds: ilev
    sources:
      - cesm_var: CLDLIQ

  clwvi_tavg-u-hxy-u:
    table: atmos
    units: "kg m-2"
    dims: [time, lat, lon]
    sources:
      - cesm_var: TGCLDLWP

  cProduct:
    table: land
    units: "kg m-2"
    dims: [time, lat, lon]
    formula: (TOTPRODC + CWD_P)/1000.0
    sources:
      - cesm_var: TOTPRODC
      - cesm_var: CWD_P

  cSoilFast:
    table: land
    units: "kg m-2"
    dims: [time, lat, lon]
    formula: (SOIL1C)/1000.0
    sources:
      - cesm_var: SOIL1C

  cSoilMedium:
    table: land
    units: "kg m-2"
    dims: [time, lat, lon]
    formula: (SOIL2C)/1000.0
    sources:
      - cesm_var: SOIL2C

  cSoilSlow:
    table: land
    units: "kg m-2"
    dims: [time, lat, lon]
    formula: (SOIL3C)/1000.0
    sources:
      - cesm_var: SOIL3C

  cVeg_tavg-u-hxy-lnd:
    table: land
    units: "kg m-2"
    dims: [time, lat, lon]
    formula: (TOTVEGC)/1000.0
    sources:
      - cesm_var: TOTVEGC

  deptho_ti-u-hxy-sea:
    table: fx
    units: "m"
    long_name: Sea Floor Depth
    standard_name: depth_below_sea_level
    dims: [yh, xh]
    regrid_method: conservative
    sources:
      - cesm_var: deptho

  evspsbl_tavg-u-hxy-ifs:
    table: ocean
    units: kg m-2 s-1
    long_name: Evaporation over ice free ocean
    dims: [time, latitude, longitude]
    regrid_method: conservative
    sources:
      - cesm_var: evs

  evspsbl_tavg-u-hxy-u:
    table: atmos
    units: kg m-2 s-1
    long_name: Evaporation
    cell_methods: "time: mean"
    dims: [time, lat, lon]
    regrid_method: conservative
    sources:
      - cesm_var: QFLX
        scale: -1.0     # flip sign if CESM positive upward

  evspsblsoi_tavg-u-hxy-lnd:
    table: land
    units: kg m-2 s-1
    long_name: Water Evaporation from Soil
    dims: [time, lat, lon]
    positive: up
    sources:
      - cesm_var: QSOIL

  evspsblveg_tavg-u-hxy-lnd:
    table: land
    units: kg m-2 s-1
    long_name: Water Evaporation from Vegetation
    dims: [time, lat, lon]
    positive: up
    sources:
      - cesm_var: QVEGE

  fFire_tavg-u-hxy-lnd:
    table: land
    units: "kg m-2 s-1"
    dims: [time, lat, lon]
    positive: up
    formula: COL_FIRE_CLOSS/1000.0
    sources:
      - cesm_var: COL_FIRE_CLOSS

  fHarvest:
    table: land
    units: "kg m-2 s-1"
    dims: [time, lat, lon]
    positive: up
    formula: WOOD_HARVESTC/1000.0
    sources:
      - cesm_var: WOOD_HARVESTC

  ficeberg_tavg-u-hxy-sea:
    table: ocean
    units: "kg m-2 s-1"
    long_name: "Iceberg Freshwater Flux"
    dims: [time, latitude, longitude]
    regrid_method: conservative
    sources:
      - cesm_var: ficeberg

  gpp_tavg-u-hxy-lnd:
    table: land
    units: "kg m-2 s-1"
    dims: [time, lat, lon]
    formula: GPP/1000.0
    positive: down
    sources:
      - cesm_var: GPP

  hfds_tavg-u-hxy-sea:
    table: ocean
    units: "W m-2"
    positive: down
    dims: [time, latitude, longitude]
    sources:
      - cesm_var: hfds

  hfls_tavg-u-hxy-u:
    table: atmos
    units: "W m-2"
    dims: [time, lat, lon]
    positive: up
    sources:
      - cesm_var: LHFLX

  hfsnthermds_tavg-u-hxy-sea:
    table: ocean
    units: "W m-2"
    long_name: "Latent Heat to melt frozen Precipitation"
    dims: [time, olevel, latitude, longitude]
    regrid_method: conservative
    sources:
      - cesm_var: hfsnthermds

  hfss_tavg-u-hxy-u:
    table: atmos
    units: "W m-2"
    dims: [time, lat, lon]
    positive: up
    sources:
      - cesm_var: SHFLX

  hurs_tavg-al-hxy-u:
    table: atmos
    units: "%"
    dims: [time, lev, lat, lon]
    levels:
      name: standard_hybrid_sigma
      units: "1"
      src_axis_name: lev
      src_axis_bnds: ilev
    sources:
      - cesm_var: RELHUM

  hur_tavg-p19-hxy-air:
    table: atmos
    units: "%"
    dims: [time, plev, lat, lon]
    levels:
      name: plev19
      units: Pa
    sources:
      - cesm_var: RELHUM

  hurs:
    table: atmos
    units: "%"
    dims: [time, lat, lon]
    sources:
      - cesm_var: RHREFHT

  hus_tavg-al-hxy-u:
    table: atmos
    units: "kg kg-1"
    dims: [time, lev, lat, lon]
    levels:
      name: standard_hybrid_sigma
      units: "1"
      src_axis_name: lev
      src_axis_bnds: ilev
    sources:
      - cesm_var: Q

  hus_tavg-p19-hxy-u:
    table: atmos
    units: "kg kg-1"
    dims: [time, plev, lat, lon]
    levels:
      name: plev19
      units: Pa
    sources:
      - cesm_var: Q

  huss:
    table: atmos
    units: "1"
    long_name: Near-Surface Specific Humidity
    dims: [time, lat, lon]
    regrid_method: bilinear
    sources:
      - cesm_var: QREFHT

  lai_tavg-u-hxy-lnd:
    table: land
    units: "1"
    dims: [time, lat, lon]
    sources:
      - cesm_var: TLAI

  mlotst_tavg-u-hxy-sea:
    table: ocean
    units: "m"
    long_name: "Ocean Mixed Layer Thickness Defined by Sigma T"
    dims: [time, latitude, longitude]
    sources:
      - cesm_var: mlotst

  mrfso:
    table: land
    units: kg m-2
    dims: [time, lat, lon]
    formula: verticalsum(SOILICE, capped_at=5000)
    sources:
      - cesm_var: SOILICE

  mrro_tavg-u-hxy-lnd:
    table: land
    units: kg m-2 s-1
    dims: [time, lat, lon]
    sources:
      - cesm_var: QRUNOFF

  mrros_tavg-u-hxy-lnd:
    table: land
    units: kg m-2 s-1
    dims: [time, lat, lon]
    sources:
      - cesm_var: QOVER

  mrso_tavg-u-hxy-lnd:
    table: land
    units: kg m-2
    dims: [time, lat, lon]
    formula: verticalsum(SOILICE + SOILLIQ, capped_at=5000)
    sources:
      - cesm_var: SOILICE
      - cesm_var: SOILLIQ

  mrsol_tavg-sl-hxy-lnd:
    table: land
    units: kg m-2
    dims: [time, sdepth, lat, lon]
    formula: SOILLIQ + SOILICE
    sources:
      - cesm_var: SOILLIQ
      - cesm_var: SOILICE

  mrsol_tavg-d10cm-hxy-lnd:
    table: land
    units: kg m-2
    dims: [time, lat, lon]
    sources:
      - cesm_var: SOILWATER_10CM

  nbp_tavg-u-hxy-lnd:
    table: land
    units: "kg m-2 s-1"
    dims: [time, lat, lon]
    formula: NBP/1000.0
    positive: down
    sources:
      - cesm_var: NBP

  npp_tavg-u-hxy-lnd:
    table: land
    units: "kg m-2 s-1"
    dims: [time, lat, lon]
    formula: NPP/1000.0
    positive: down
    sources:
      - cesm_var: NPP

  pr_tavg-u-hxy-u:
    table: atmos
    units: kg m-2 s-1
    long_name: Precipitation
    standard_name: precipitation_flux
    cell_methods: "time: mean"
    dims: [time, lat, lon]
    regrid_method: conservative
    sources:
      - cesm_var: PRECT
        scale: 1000.0   # convert from m/s to kg m-2 s-1 if needed

  prc_tavg-u-hxy-u:
    table: atmos
    units: "kg m-2 s-1"
    dims: [time, lat, lon]
    # PRECC is in m s-1 (water equivalent) → convert to kg m-2 s-1
    formula: PRECC * 1000.0
    sources:
      - cesm_var: PRECC

  prsn_tavg-u-hxy-u:
    table: atmos
    units: "kg m-2 s-1"
    dims: [time, lat, lon]
    # PRECSC/PRECSL are snowfall rates in m s-1 (water equiv) → convert to kg m-2 s-1
    formula: (PRECSC + PRECSL) * 1000.0
    sources:
      - cesm_var: PRECSC
      - cesm_var: PRECSL

  prveg_tavg-u-hxy-lnd:
    table: land
    units: "kg m-2 s-1"
    dims: [time, lat, lon]
    sources:
      - cesm_var: QINTR

  prw_tavg-u-hxy-u:
    table: atmos
    units: "kg m-2"
    dims: [time, lat, lon]
    sources:
      - cesm_var: TMQ

  psl_tavg-u-hxy-u:
    table: atmos
    units: Pa
    long_name: Sea Level Pressure
    cell_methods: "time: mean"
    dims: [time, lat, lon]
    regrid_method: bilinear
    sources:
      - cesm_var: PSL

  ps_tavg-u-hxy-u:
    table: atmos
    units: Pa
    long_name: Surface Air Pressure
    cell_methods: "time: mean"
    dims: [time, lat, lon]
    regrid_method: bilinear
    sources:
      - cesm_var: PS

  ra_tavg-u-hxy-lnd:
    table: land
    units: "kg m-2 s-1"
    dims: [time, lat, lon]
    positive: up
    formula: AR/1000.0
    sources:
      - cesm_var: AR

  rh_tavg-u-hxy-lnd:
    table: land
    units: "kg m-2 s-1"
    dims: [time, lat, lon]
    positive: up
    formula: HR/1000.0
    sources:
      - cesm_var: HR

  rlds_tavg-u-hxy-u:
    table: atmos
    units: "W m-2"
    dims: [time, lat, lon]
    positive: up
    sources:
      - cesm_var: FLDS

  rldscs_tavg-u-hxy-u:
    table: atmos
    units: "W m-2"
    dims: [time, lat, lon]
    positive: up
    formula: FLDS + FLNS - FLNSC
    sources:
      - cesm_var: FLDS
      - cesm_var: FLNS
      - cesm_var: FLNSC

  rlus_tavg-u-hxy-u:
    table: atmos
    units: "W m-2"
    dims: [time, lat, lon]
    positive: up
    formula: FLDS + FLNS
    sources:
      - cesm_var: FLDS
      - cesm_var: FLNS

  rluscs_tavg-u-hxy-u:
    table: atmos
    units: "W m-2"
    dims: [time, lat, lon]
    positive: up
    sources:
      - cesm_var: FLNSC

  rlut_tavg-u-hxy-u:
    table: atmos
    units: "W m-2"
    dims: [time, lat, lon]
    positive: up
    sources:
      - cesm_var: FLUT

  rlutcs:
    table: atmos
    units: "W m-2"
    dims: [time, lat, lon]
    positive: up
    sources:
      - cesm_var: FLUTC

  rsds_tavg-u-hxy-u:
    table: atmos
    units: "W m-2"
    dims: [time, lat, lon]
    positive: up
    sources:
      - cesm_var: FSDS

  rsdscs_tavg-u-hxy-u:
    table: atmos
    units: "W m-2"
    dims: [time, lat, lon]
    positive: up
    sources:
      - cesm_var: FSDSC

  rsdt_tavg-u-hxy-u:
    table: atmos
    units: "W m-2"
    dims: [time, lat, lon]
    positive: up
    sources:
      - cesm_var: SOLIN

  rsus_tavg-u-hxy-u:
    table: atmos
    units: "W m-2"
    dims: [time, lat, lon]
    positive: up
    formula: FSDS - FSNS
    sources:
      - cesm_var: FSDS
      - cesm_var: FSNS

  rsuscs_tavg-u-hxy-u:
    table: atmos
    units: "W m-2"
    dims: [time, lat, lon]
    positive: up
    formula: FSDSC - FSNSC
    sources:
      - cesm_var: FSDSC
      - cesm_var: FSNSC

  rsut:
    table: atmos
    units: "W m-2"
    dims: [time, lat, lon]
    positive: up
    sources:
      - cesm_var: FLUT

  rsutcs_tavg-u-hxy-u:
    table: atmos
    units: "W m-2"
    dims: [time, lat, lon]
    formula: SOLIN - FSNTOAC
    positive: up
    sources:
      - cesm_var: SOLIN
      - cesm_var: FSNTOAC

  snld:
    table: land
    units: "m"
    dims: [time, lat, lon]
    sources:
      - cesm_var: SNOW_DEPTH

  soga:
    table: ocean
    units: "1e-3"
    dims:
      - [time, latitude, longitude]
      - [time, lat, lon]
    regrid_method: conservative
    sources:
      - cesm_var: soga

  sos_tavg-u-hxy-sea:
    table: ocean
    units: "1e-3"
    dims:
      - [time, latitude, longitude]
      - [time, lat, lon]
    regrid_method: conservative
    sources:
      - cesm_var: sos

  sos_max:
    table: ocean
    units: "1e-3"
    dims:
      - [time, latitude, longitude]   # for curvilinear grids
      - [time, lat, lon]
    regrid_method: conservative
    sources:
      - cesm_var: sos_max

  sos_min:
    table: ocean
    units: "1e-3"
    dims:
      - [time, latitude, longitude]   # for curvilinear grids
      - [time, lat, lon]
    regrid_method: conservative
    sources:
      - cesm_var: sos_min

  sfcWind_tavg-h10m-hxy-u:
    table: atmos
    units: "m s-1"
    dims: [time, lat, lon]
    sources:
      - cesm_var: U10

  sftlf:
    table: fx
    units: "%"
    dims: [lat, lon]
    formula: LANDFRAC * 100.0
    sources:
      - cesm_var: LANDFRAC

  ta_tavg-al-hxy-u:
    table: atmos
    units: K
    long_name: Air Temperature
    dims: [time, lev, lat, lon]
    regrid_method: bilinear
    levels:
      name: standard_hybrid_sigma
      units: "1"
      src_axis_name: lev
      src_axis_bnds: ilev
    sources:
      - cesm_var: T

  ta_tavg-p19-hxy-air:
    table: atmos
    units: K
    long_name: Air Temperature
    dims: [time, plev, lat, lon]
    regrid_method: bilinear
    levels:
      name: plev19
      units: Pa
    sources:
      - cesm_var: T

  tas_tavg-h2m-hxy-u:
    table: atmos
    units: K
    long_name: Near-Surface Air Temperature
    standard_name: air_temperature
    cell_methods: "time: mean"
    dims: [time, lat, lon]
    regrid_method: bilinear
    sources:
      - cesm_var: TS

  tasmax:
    table: atmos
    units: "K"
    dims: [time, lat, lon]
    sources:
      - cesm_var: TREFHTMX

  tasmin:
    table: atmos
    units: "K"
    dims: [time, lat, lon]
    sources:
      - cesm_var: TREFHTMN

  tauu:
    table: atmos
    units: "N m-2"
    dims: [time, lat, lon]
    positive: up
    sources:
      - cesm_var: TAUX

  tauuo_tavg-u-hxy-sea:
    table: ocean
    units: "N m-2"
    dims: [time, latitude, longitude]
    positive: down
    sources:
      - cesm_var: tauuo

  tauv:
    table: atmos
    units: "N m-2"
    dims: [time, lat, lon]
    positive: up
    sources:
      - cesm_var: TAUY

  tauvo_tavg-u-hxy-sea:
    table: ocean
    units: "N m-2"
    dims: [time, latitude, longitude]
    positive: down
    sources:
      - cesm_var: tauvo

  tdps:
    table: atmos
    units: "K"
    dims: [time, plev, lat, lon]
    levels:
      name: plev19
      units: Pa
    sources:
      - cesm_var: TD
  thetao:
    table: ocean
    units: "K"
    dims:
      - [time, z_l, latitude, longitude]
      - [time, z_l, lat, lon]
    regrid_method: bilinear
    sources:
      - cesm_var: thetao

  thetaoga:
    table: ocean
    units: "K"
    dims:
      - [time, z_l, latitude, longitude]
      - [time, z_l, lat, lon]
    regrid_method: bilinear
    sources:
      - cesm_var: thetaoga

  tnhus:
    table: atmos
    units: "kg kg-1"
    dims: [time, plev, lat, lon]
    levels:
      name: plev19
      units: Pa
    sources:
      - cesm_var: Q

  tnt:
    table: atmos
    units: "K s-1"
    dims: [time, plev, lat, lon]
    levels:
      name: plev19
      units: Pa
    sources:
      - cesm_var: T

  tos_tavg-u-hxy-sea:
    table: ocean
    units: "K"
    dims:
      - [time, latitude, longitude]
      - [time, lat, lon]
    regrid_method: bilinear
    sources:
      - cesm_var: tos

  tran_tavg-u-hxy-lnd:
    table: land
    units: "kg m-2 s-1"
    dims: [time, lat, lon]
    positive: up
    formula: QSOIL + QVEGT
    sources:
      - cesm_var: QVEGT
      - cesm_var: QSOIL

  ts:
    table: atmos
    units: "K"
    dims: [time, lat, lon]
    sources:
      - cesm_var: TS

  tsl_tavg-sl-hxy-lnd:
    table: land
    units: "K"
    dims: [time, sdepth, lat, lon]
    sources:
      - cesm_var: TSOI

  ua_tavg-al-hxy-u:
    table: atmos
    units: m s-1
    long_name: Zonal Wind
    dims: [time, lev, lat, lon]
    regrid_method: bilinear
    levels:
      name: standard_hybrid_sigma
      units: "1"
      src_axis_name: lev
      src_axis_bnds: ilev
    sources:
      - cesm_var: U

  ua_tavg-p19-hxy-air:
    table: atmos
    units: m s-1
    long_name: Zonal Wind
    dims: [time, plev, lat, lon]
    regrid_method: bilinear
    levels:
      name: plev19
      units: Pa
    sources:
      - cesm_var: U

  uas_tavg-h10m-hxy-u:
    table: atmos
    units: "m s-1"
    dims: [time, lat, lon]
    sources:
      - cesm_var: U10

  umo:
    table: ocean
    units: "kg s-1"
    dims: [time, z_l, latitude, longitude]
    sources:
      - cesm_var: umo

  va_tavg-al-hxy-u:
    table: atmos
    units: m s-1
    long_name: Meridional Wind
    dims: [time, lev, lat, lon]
    regrid_method: bilinear
    levels:
      name: standard_hybrid_sigma
      units: "1"
      src_axis_name: lev
      src_axis_bnds: ilev
    sources:
      - cesm_var: V

  va_tavg-p19-hxy-air:
    table: atmos
    units: m s-1
    long_name: Meridional Wind
    dims: [time, plev, lat, lon]
    regrid_method: bilinear
    levels:
      name: plev19
      units: Pa
    sources:
      - cesm_var: V

  vas_tavg-h10m-hxy-u:
    table: atmos
    units: "m s-1"
    dims: [time, lat, lon]
    sources:
      - cesm_var: VBOT

  vmo:
    table: ocean
    units: "kg s-1"
    dims: [time, z_l, latitude, longitude]
    sources:
      - cesm_var: vmo

  vo:
    table: ocean
    units: "m s-1"
    dims:
      - [time, z_l, latitude, longitude]
      - [time, z_l, lat, lon]
    regrid_method: bilinear
    sources:
      - cesm_var: vo

  volcello:
    table: ocean
    units: "m3"
    dims: [time, z_l, latitude, longitude]
    sources:
      - cesm_var: volcello

  wap:
    table: atmos
    units: "Pa s-1"
    dims: [time, plev, lat, lon]
    levels:
      name: plev19
      units: Pa
    sources:
      - cesm_var: OMEGA

  wfo:
    table: ocean
    units: kg m-2 s-1
    long_name: "Freshwater Flux into Sea Water"
    dims: [time, latitude, longitude]
    sources:
      - cesm_var: wfo

  zg:
    table: atmos
    units: "m"
    dims: [time, plev, lat, lon]
    levels:
      name: plev19
      units: Pa
    sources:
      - cesm_var: Z3

  zos:
    table: ocean
    units: "m"
    dims: [time, latitude, longitude]
    regrid_method: bilinear
    sources:
      - cesm_var: zos

  zossq:
    table: ocean
    units: "m2"
    dims: [time, latitude, longitude]
    regrid_method: bilinear
    sources:
      - cesm_var: zossq

#  areacella:
#    table: fx
#    units: m2
#    formula: area * 1.e6
#    standard_name: cell_area
#    dims: [lat, lon]
#    sources:
#      - cesm_var: ZBOT
#
#
#  sftlf:
#    table: fx
#    units: '%'
#    formula: landfrac * 100
#    dims: [lat, lon]
#    sources:
#      - cesm_var: ZBOT
